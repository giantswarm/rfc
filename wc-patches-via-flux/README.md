---
creation_date: 2025-06-27
issues:
- https://github.com/giantswarm/giantswarm/issues/33715
- https://github.com/giantswarm/vodafone/issues/810
owners:
- https://github.com/orgs/giantswarm/teams/team-tenet
state: review
summary: An approach to leveraging Flux to apply patches and one-off manifests into Workload Clusters in a manner that fits in with our Releases process.
---

# Title

Workload Cluster patch management via Flux

### Problem statement

Currently the only approach we have to deploying changes into all workload clusters automatically is to include those changes within an App and include within the providers default apps or alternatively have a specific operator on the management cluster responsible for applying those changes.

This approach has quite a large overhead when it comes to small or one-off patches that we want to apply to all workload clusters as an entire App must be maintained for the patch to be applied.

We currently have some use cases (see https://github.com/giantswarm/vodafone/issues/810 and https://github.com/giantswarm/giantswarm/issues/33715) where it would be useful to have a way to include patches to Kubernetes-default resources or to introduce single resources within all workload clusters.

### Decision maker

@giantswarm/team-tenet

### Deadline

1st August 2025

### Who is affected / stakeholders

Those with an interest in the fleet management capabilities:

* @giantswarm/team-tenet
* @giantswarm/team-honeybadger

Those that have an interest in leveraging this capability:

* @giantswarm/team-shield

### Preferred solution

The current preferred solution is to leverage Flux, that we already have setup on all MCs, to handle applying the changes into workload clusters using the Kubeconfig credential secrets created by CAPI.

1. The `cluster` chart will be updated to include a new `GitRepo` and `Kustomization` CR that gets generated for each `Cluster`.
2. The `GitRepo` will point to the `releases` repository with the **specific tag** of the Release used by the cluster. (This ensures they are tied to a given Release and not mutatable)
3. The `Kustomization` will have it's `path` property pointing to a specific directory within the `releases` repository that contains the manifests for the correct Release provider.
4. The `Kustomization` will have it's `prune` property set to `true`, which means that all manifests in the directory will be deleted from the cluster if removed from source.
5. The `kubeconfig` property will point to the Secret generated by CAPI for that specific workload cluster.

### Alternative solutions

TODO: Need to add alternative solutions here.

### Implementation plan

TODO: Need to populate this following feedback from others.

### Communication plan

TODO: Need to populate this following feedback from others.
